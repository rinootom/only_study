<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>NeoPixel RGB 제어</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    .color-box {
      width: 100px; height: 100px; margin: 20px auto;
      border: 1px solid #ccc;
    }
    .label-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px 0;
      gap: 10px;
    }
    .slider { width: 200px; }
    .value-input { width: 50px; }
    .btn {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>NeoPixel RGB 제어</h2>
  <div class="color-box" id="colorBox"></div>

  <div class="label-row">
    <label>R: <input type="range" id="r" min="0" max="255" value="0" class="slider"></label>
    <input type="number" id="r_val" class="value-input" min="0" max="255" value="0">
  </div>
  <div class="label-row">
    <label>G: <input type="range" id="g" min="0" max="255" value="0" class="slider"></label>
    <input type="number" id="g_val" class="value-input" min="0" max="255" value="0">
  </div>
  <div class="label-row">
    <label>B: <input type="range" id="b" min="0" max="255" value="0" class="slider"></label>
    <input type="number" id="b_val" class="value-input" min="0" max="255" value="0">
  </div>

  <div style="margin-top: 20px;">
    <button class="btn" id="onBtn" style="background-color: #4CAF50; color: white;">ON</button>
    <button class="btn" id="offBtn" style="background-color: #ccc; color: black;">OFF</button>
  </div>

  <script>
    const rSlider = document.getElementById("r");
    const gSlider = document.getElementById("g");
    const bSlider = document.getElementById("b");

    const rVal = document.getElementById("r_val");
    const gVal = document.getElementById("g_val");
    const bVal = document.getElementById("b_val");

    const onBtn = document.getElementById("onBtn");
    const offBtn = document.getElementById("offBtn");

    const colorBox = document.getElementById("colorBox");

      window.onload = function () {
        updateColor(); // 슬라이더 위치에 맞춰서 색상 박스와 값 동기화
      };  
    function updateColor() {
      const r = parseInt(rSlider.value);
      const g = parseInt(gSlider.value);
      const b = parseInt(bSlider.value);

      rVal.value = r;
      gVal.value = g;
      bVal.value = b;

      colorBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

      fetch("/set_color", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ r, g, b })
      });
    }

    function updateFromInput() {
      rSlider.value = rVal.value;
      gSlider.value = gVal.value;
      bSlider.value = bVal.value;
      updateColor();
    }

    function setLED(on) {
      fetch("/toggle", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ on: on })
      })
      .then(res => res.json())
      .then(data => {
        if (data.on) {
          onBtn.style.backgroundColor = "#4CAF50";
          onBtn.style.color = "white";
          offBtn.style.backgroundColor = "#ccc";
          offBtn.style.color = "black";
        } else {
          offBtn.style.backgroundColor = "#f44336";
          offBtn.style.color = "white";
          onBtn.style.backgroundColor = "#ccc";
          onBtn.style.color = "black";
        }
      });
    }

    rSlider.addEventListener("input", updateColor);
    gSlider.addEventListener("input", updateColor);
    bSlider.addEventListener("input", updateColor);

    rVal.addEventListener("input", updateFromInput);
    gVal.addEventListener("input", updateFromInput);
    bVal.addEventListener("input", updateFromInput);

    onBtn.addEventListener("click", () => setLED(true));
    offBtn.addEventListener("click", () => setLED(false));
  </script>
</body>
</html>
